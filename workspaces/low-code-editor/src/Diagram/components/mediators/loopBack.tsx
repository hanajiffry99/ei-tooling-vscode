/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";

interface SquareProps {
  model: Circle;
}

export function LoopBack(props: SquareProps) {
  const { model } = props;

  const viewState = model.viewState;
  const components: JSX.Element[] = [];

  model.children.forEach((child) => {
    components.push(getComponent(child.type, { model: child }));
  });

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle id="Ellipse 1" cx="300" cy="300" r="300" fill="#3D84B8" />
        <g id="Rectangle 2" filter="url(#filter0_d_77_165)">
          <rect
            x="118"
            y="152"
            width="363"
            height="248"
            rx="40"
            fill="#3D84B8"
          />
          <rect
            x="121"
            y="155"
            width="357"
            height="242"
            rx="37"
            stroke="white"
            stroke-width="6"
          />
        </g>
        <path
          id="Loop Back"
          d="M176.161 522V485.636H183.849V515.661H199.438V522H176.161ZM216.71 522.533C213.952 522.533 211.567 521.947 209.555 520.775C207.554 519.591 206.009 517.946 204.92 515.839C203.831 513.72 203.287 511.264 203.287 508.47C203.287 505.653 203.831 503.191 204.92 501.084C206.009 498.965 207.554 497.32 209.555 496.148C211.567 494.964 213.952 494.372 216.71 494.372C219.468 494.372 221.847 494.964 223.848 496.148C225.86 497.32 227.411 498.965 228.5 501.084C229.589 503.191 230.133 505.653 230.133 508.47C230.133 511.264 229.589 513.72 228.5 515.839C227.411 517.946 225.86 519.591 223.848 520.775C221.847 521.947 219.468 522.533 216.71 522.533ZM216.746 516.673C218 516.673 219.048 516.318 219.888 515.608C220.729 514.886 221.362 513.903 221.788 512.661C222.226 511.418 222.445 510.003 222.445 508.417C222.445 506.831 222.226 505.416 221.788 504.173C221.362 502.93 220.729 501.948 219.888 501.226C219.048 500.504 218 500.143 216.746 500.143C215.479 500.143 214.414 500.504 213.55 501.226C212.697 501.948 212.052 502.93 211.614 504.173C211.188 505.416 210.975 506.831 210.975 508.417C210.975 510.003 211.188 511.418 211.614 512.661C212.052 513.903 212.697 514.886 213.55 515.608C214.414 516.318 215.479 516.673 216.746 516.673ZM247.374 522.533C244.616 522.533 242.231 521.947 240.219 520.775C238.218 519.591 236.673 517.946 235.584 515.839C234.495 513.72 233.951 511.264 233.951 508.47C233.951 505.653 234.495 503.191 235.584 501.084C236.673 498.965 238.218 497.32 240.219 496.148C242.231 494.964 244.616 494.372 247.374 494.372C250.132 494.372 252.511 494.964 254.512 496.148C256.524 497.32 258.075 498.965 259.164 501.084C260.253 503.191 260.797 505.653 260.797 508.47C260.797 511.264 260.253 513.72 259.164 515.839C258.075 517.946 256.524 519.591 254.512 520.775C252.511 521.947 250.132 522.533 247.374 522.533ZM247.41 516.673C248.664 516.673 249.712 516.318 250.552 515.608C251.393 514.886 252.026 513.903 252.452 512.661C252.89 511.418 253.109 510.003 253.109 508.417C253.109 506.831 252.89 505.416 252.452 504.173C252.026 502.93 251.393 501.948 250.552 501.226C249.712 500.504 248.664 500.143 247.41 500.143C246.143 500.143 245.078 500.504 244.214 501.226C243.361 501.948 242.716 502.93 242.278 504.173C241.852 505.416 241.639 506.831 241.639 508.417C241.639 510.003 241.852 511.418 242.278 512.661C242.716 513.903 243.361 514.886 244.214 515.608C245.078 516.318 246.143 516.673 247.41 516.673ZM265.716 532.227V494.727H273.173V499.308H273.51C273.842 498.574 274.321 497.829 274.949 497.071C275.588 496.302 276.416 495.662 277.434 495.153C278.464 494.633 279.743 494.372 281.27 494.372C283.258 494.372 285.093 494.893 286.774 495.935C288.455 496.964 289.798 498.521 290.805 500.604C291.811 502.676 292.314 505.274 292.314 508.399C292.314 511.441 291.823 514.01 290.84 516.105C289.869 518.188 288.544 519.769 286.863 520.846C285.194 521.911 283.323 522.444 281.252 522.444C279.784 522.444 278.535 522.201 277.506 521.716C276.488 521.231 275.653 520.621 275.002 519.887C274.351 519.141 273.854 518.39 273.51 517.632H273.28V532.227H265.716ZM273.12 508.364C273.12 509.985 273.345 511.4 273.795 512.607C274.244 513.815 274.895 514.756 275.748 515.43C276.6 516.093 277.636 516.425 278.855 516.425C280.086 516.425 281.128 516.087 281.98 515.413C282.832 514.726 283.477 513.779 283.915 512.572C284.365 511.353 284.59 509.95 284.59 508.364C284.59 506.789 284.371 505.404 283.933 504.209C283.495 503.013 282.85 502.078 281.998 501.403C281.145 500.729 280.098 500.391 278.855 500.391C277.624 500.391 276.582 500.717 275.73 501.368C274.89 502.019 274.244 502.942 273.795 504.138C273.345 505.333 273.12 506.742 273.12 508.364ZM309.071 522V485.636H323.63C326.306 485.636 328.537 486.033 330.324 486.826C332.112 487.619 333.455 488.72 334.355 490.129C335.254 491.525 335.704 493.135 335.704 494.958C335.704 496.379 335.42 497.627 334.852 498.705C334.284 499.77 333.502 500.646 332.508 501.332C331.526 502.007 330.401 502.487 329.135 502.771V503.126C330.52 503.185 331.816 503.576 333.023 504.298C334.242 505.02 335.231 506.032 335.988 507.334C336.746 508.624 337.125 510.163 337.125 511.95C337.125 513.88 336.645 515.602 335.686 517.117C334.739 518.621 333.337 519.81 331.478 520.686C329.62 521.562 327.329 522 324.607 522H309.071ZM316.759 515.714H323.027C325.169 515.714 326.732 515.306 327.714 514.489C328.697 513.661 329.188 512.56 329.188 511.187C329.188 510.181 328.945 509.293 328.46 508.523C327.975 507.754 327.282 507.15 326.382 506.712C325.495 506.274 324.435 506.055 323.204 506.055H316.759V515.714ZM316.759 500.853H322.458C323.512 500.853 324.447 500.67 325.264 500.303C326.092 499.924 326.743 499.391 327.217 498.705C327.702 498.018 327.945 497.195 327.945 496.237C327.945 494.923 327.477 493.863 326.542 493.058C325.619 492.253 324.305 491.851 322.6 491.851H316.759V500.853ZM349.762 522.515C348.022 522.515 346.472 522.213 345.11 521.609C343.749 520.994 342.672 520.088 341.879 518.893C341.097 517.685 340.707 516.182 340.707 514.383C340.707 512.868 340.985 511.595 341.541 510.565C342.098 509.536 342.855 508.707 343.814 508.08C344.773 507.452 345.862 506.979 347.081 506.659C348.312 506.339 349.602 506.115 350.952 505.984C352.538 505.819 353.816 505.665 354.787 505.523C355.758 505.369 356.462 505.144 356.9 504.848C357.338 504.552 357.557 504.114 357.557 503.534V503.428C357.557 502.303 357.202 501.433 356.492 500.817C355.793 500.202 354.799 499.894 353.509 499.894C352.147 499.894 351.064 500.196 350.259 500.8C349.454 501.392 348.922 502.137 348.661 503.037L341.666 502.469C342.021 500.812 342.719 499.379 343.761 498.172C344.802 496.953 346.146 496.018 347.791 495.366C349.449 494.704 351.366 494.372 353.544 494.372C355.059 494.372 356.509 494.55 357.894 494.905C359.291 495.26 360.528 495.81 361.605 496.556C362.694 497.302 363.552 498.261 364.18 499.433C364.807 500.593 365.121 501.983 365.121 503.605V522H357.948V518.218H357.735C357.297 519.07 356.711 519.822 355.977 520.473C355.243 521.112 354.361 521.615 353.331 521.982C352.301 522.337 351.112 522.515 349.762 522.515ZM351.928 517.295C353.041 517.295 354.024 517.076 354.876 516.638C355.728 516.188 356.397 515.584 356.882 514.827C357.368 514.069 357.61 513.211 357.61 512.252V509.358C357.374 509.512 357.048 509.654 356.634 509.784C356.231 509.902 355.776 510.015 355.267 510.121C354.758 510.216 354.249 510.305 353.74 510.388C353.231 510.459 352.769 510.524 352.355 510.583C351.467 510.713 350.691 510.92 350.029 511.205C349.366 511.489 348.851 511.873 348.484 512.359C348.117 512.832 347.933 513.424 347.933 514.134C347.933 515.164 348.306 515.951 349.052 516.496C349.81 517.028 350.768 517.295 351.928 517.295ZM383.312 522.533C380.518 522.533 378.115 521.941 376.103 520.757C374.102 519.562 372.564 517.904 371.486 515.786C370.421 513.667 369.888 511.228 369.888 508.47C369.888 505.677 370.427 503.226 371.504 501.119C372.593 499 374.138 497.349 376.138 496.165C378.139 494.97 380.518 494.372 383.276 494.372C385.655 494.372 387.739 494.804 389.526 495.668C391.314 496.532 392.728 497.746 393.77 499.308C394.811 500.871 395.385 502.705 395.492 504.812H388.354C388.153 503.451 387.62 502.356 386.756 501.528C385.904 500.687 384.785 500.267 383.4 500.267C382.229 500.267 381.205 500.587 380.329 501.226C379.465 501.853 378.79 502.771 378.305 503.978C377.819 505.185 377.577 506.647 377.577 508.364C377.577 510.104 377.813 511.583 378.287 512.803C378.772 514.022 379.453 514.951 380.329 515.59C381.205 516.229 382.229 516.549 383.4 516.549C384.265 516.549 385.04 516.371 385.726 516.016C386.425 515.661 386.999 515.146 387.449 514.472C387.91 513.785 388.212 512.962 388.354 512.004H395.492C395.374 514.087 394.805 515.922 393.787 517.508C392.781 519.082 391.39 520.313 389.615 521.201C387.839 522.089 385.738 522.533 383.312 522.533ZM407.189 514.152L407.206 505.079H408.307L417.043 494.727H425.725L413.989 508.435H412.196L407.189 514.152ZM400.335 522V485.636H407.899V522H400.335ZM417.38 522L409.355 510.121L414.397 504.777L426.24 522H417.38Z"
          fill="white"
        />
        <path
          id="Vector"
          d="M154.778 274.447C154.778 289.981 160.556 304.051 169.8 314.896L149 336H201V283.24L180.084 304.461C173.382 296.313 169.222 285.936 169.222 274.447C169.222 253.694 182.569 236.049 201 229.894L196.493 216C172.284 224.149 154.778 247.187 154.778 274.447Z"
          fill="white"
        />
        <path
          id="Vector_2"
          d="M445.222 277.553C445.222 262.019 439.444 247.949 430.2 237.104L451 216H399V268.76L419.916 247.539C426.618 255.687 430.778 266.064 430.778 277.553C430.778 298.306 417.431 315.951 399 322.107L403.507 336C427.716 327.851 445.222 304.813 445.222 277.553Z"
          fill="white"
        />
        <rect
          id="Rectangle 1"
          width="238.507"
          height="17.6711"
          transform="matrix(0.898228 0.43953 -0.432902 0.901441 196.21 215.502)"
          fill="white"
        />
        <defs>
          <filter
            id="filter0_d_77_165"
            x="114"
            y="152"
            width="371"
            height="256"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="4" />
            <feGaussianBlur stdDeviation="2" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_77_165"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_77_165"
              result="shape"
            />
          </filter>
        </defs>
      </svg>

      <WorkerLine model={model} />
      {components}
    </>
  );
}
